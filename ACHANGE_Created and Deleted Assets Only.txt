SELECT

ACHANGE.ZTRANSACTIONID,
ACHANGE.ZCHANGETYPE,
ACHANGE.ZENTITY,
PK_ZENTITY.Z_NAME AS 'Entity Name',
ACHANGE.ZENTITYPK,

CASE
WHEN ACHANGE.ZENTITY IS 3 THEN ZASSET.ZFILENAME
ELSE NULL
END AS 'File Name', 

ACHANGE.ZTOMBSTONE0,
ACHANGE.ZTOMBSTONE1,
ACHANGE.ZTOMBSTONE2,
ACHANGE.ZTOMBSTONE3,
ACHANGE.ZTOMBSTONE4,
ACHANGE.ZTOMBSTONE5,
ATRANSACTION.ZCONTEXTNAMETS,
TS_ZCONTEXTNAMETS.ZNAME AS 'Context Name',
ATRANSACTION.ZTIMESTAMP,
datetime (ATRANSACTION.ZTIMESTAMP + 978307200, 'unixepoch') AS 'Date and Time'

FROM ACHANGE

LEFT JOIN ATRANSACTION
ON ATRANSACTION.Z_PK = ACHANGE.ZTRANSACTIONID 

LEFT JOIN ATRANSACTIONSTRING AS TS_ZCONTEXTNAMETS
ON TS_ZCONTEXTNAMETS.Z_PK = ATRANSACTION.ZCONTEXTNAMETS

LEFT JOIN Z_PRIMARYKEY AS PK_Z_ENT
ON PK_Z_ENT.Z_ENT = ACHANGE.Z_ENT 

LEFT JOIN Z_PRIMARYKEY AS PK_ZENTITY
ON PK_ZENTITY.Z_ENT = ACHANGE.ZENTITY 

LEFT JOIN ZASSET
ON ZASSET.Z_PK = ACHANGE.ZENTITYPK

WHERE
PK_ZENTITY.Z_NAME  like 'Asset' 
AND ZCHANGETYPE IN (0, 2)

ORDER BY
ACHANGE.ZENTITYPK ASC,
ACHANGE.ZTRANSACTIONID ASC
