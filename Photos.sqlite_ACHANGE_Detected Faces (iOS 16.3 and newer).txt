SELECT

ACHANGE.ZTRANSACTIONID,
ACHANGE.ZCHANGETYPE,
ACHANGE.ZENTITY,
PK_ZENTITY.Z_NAME AS 'ENTITY NAME',

CASE
WHEN ACHANGE.ZENTITY IS 3 THEN ZASSET.ZFILENAME
ELSE NULL
END AS 'ENTITY FILE NAME', 

ATRANSACTION.ZAUTHORTS,
TS_ZAUTHORTS.ZNAME,

ATRANSACTION.ZTIMESTAMP,
DATETIME (ATRANSACTION.ZTIMESTAMP + 978307200, 'UNIXEPOCH') AS 'DATE AND TIME'


FROM ACHANGE

LEFT JOIN ATRANSACTION
ON ATRANSACTION.Z_PK = ACHANGE.ZTRANSACTIONID 

LEFT JOIN ATRANSACTIONSTRING AS TS_ZCONTEXTNAMETS
ON TS_ZCONTEXTNAMETS.Z_PK = ATRANSACTION.ZCONTEXTNAMETS

LEFT JOIN Z_PRIMARYKEY AS PK_Z_ENT
ON PK_Z_ENT.Z_ENT = ACHANGE.Z_ENT 

LEFT JOIN Z_PRIMARYKEY AS PK_ZENTITY
ON PK_ZENTITY.Z_ENT = ACHANGE.ZENTITY 

LEFT JOIN ZASSET
ON ZASSET.Z_PK = ACHANGE.ZENTITYPK

LEFT JOIN ZDETECTEDFACE
ON ZDETECTEDFACE.Z_PK = ACHANGE.ZENTITYPK

LEFT JOIN ATRANSACTIONSTRING AS TS_ZAUTHORTS
ON TS_ZAUTHORTS.Z_PK = ATRANSACTION.ZAUTHORTS

WHERE 

PK_ZENTITY.Z_NAME  IN ('Asset', 'DetectedFace')
AND ZCHANGETYPE IN (0) 
AND TS_ZAUTHORTS.ZNAME IN ('[0,1,0]')

ORDER BY ACHANGE.ZTRANSACTIONID